<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>เพิ่มธุรกรรม</title>
  <link rel="stylesheet" href="../css/add-transaction.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.0/css/all.min.css">
</head>
<body>
  <!-- SIDEBAR -->
  <div class="sidebar">
    <ul class="menu">
        <li><a href="start.html"><i class="fas fa-bullseye"></i> กำหนดเป้าหมายใหม่</a></li>
        <li><a href="calendar.html"><i class="fas fa-calendar-alt"></i> ปฏิทินรายรับ-รายจ่าย</a></li>
        <li><a href="dashboard.html"><i class="fas fa-file-alt"></i> รายงานธุรกรรม</a></li>
        
        <li class="has-submenu">
            <a href="#" class="toggle-submenu"><i class="fas fa-chart-line"></i> ลงทุนDCA </a>
            <ul class="submenu">
                <li><a href="calculator.html">คำนวณDCA</a></li>
                <li><a href="dca-progress.html">ความคืบหน้าของDCA</a></li>
            </ul>
        </li>
   
        <li class="has-submenu">
            <a href="#" class="toggle-submenu"><i class="fas fa-credit-card"></i> การชำระผ่อน </a>
            <ul class="submenu">
                <li><a href="install-plan.html">แบบจำลองการซ้อมผ่อน</a></li>
                <li><a href="install-progress.html">ความคืบหน้าของการซ้อมผ่อน</a></li>
            </ul>
        </li>
   
        <li class="has-submenu">
            <a href="#" class="toggle-submenu"><i class="fas fa-piggy-bank"></i> การออมเงิน </a>
            <ul class="submenu">
                <li><a href="saving-progress.html">ความคืบหน้าของการออมเงิน</a></li>
            </ul>
        </li>
       
        <li><a href="emergencyfund-progress.html"><i class="fa-solid fa-shield-heart"></i> เงินสำรองฉุกเฉิน</a></li>
   
        <li><a href="adjust.html"><i class="fas fa-cogs"></i> ปรับแผนการเงิน</a></li>
    </ul>
   </div>
  <!-- ส่วนเนื้อหาหลัก -->
  <div class="container">
    <!-- ส่วนหัว -->
    <div class="header">
    <!-- ฟอร์มเพิ่มธุรกรรม -->
      <h3>เพิ่มธุรกรรม</h3>
      <form action="#" method="post">
        <div class="form-group">
          <label for="date">วันครบกำหนดชำระ</label>
          <input type="date" id="date" name="date" required />
        </div>
        <div class="form-group">
          <label for="amount">จำนวนเงิน</label>
          <input type="number" id="amount" name="amount" placeholder="ระบุจำนวนเงิน" required />
        </div>
        <div class="form-group">
          <label for="transaction-type">ประเภทของเงินออม</label>
          <select id="transaction-type" name="transaction-type" required>
            <option value="">-- เลือกประเภท --</option>
            <option value="savinge">เงินออม</option>
            <option value="installment">ซ้อมผ่อน</option>
            <option value="DCA">DCA</option>
          </select>
        </div>
        <div class="form-group">
          <label for="detail">รายละเอียด</label>
          <textarea id="detail" name="detail" rows="4" placeholder="ระบุรายละเอียดเพิ่มเติม"></textarea>
        </div>
        <div class="form-group checkbox-inline">
          <input type="checkbox" id="notify" name="notify" />
          <label for="notify">ต้องการแจ้งเตือนเมื่อถึงกำหนดการออม</label>
        </div>
      </form>

      <div class="btn-group">
        <!-- ปุ่ม "บันทึก" จะเรียกฟังก์ชัน saveTransaction() -->
        <button type="button" class="submit" onclick="saveTransaction()">บันทึก</button>
        <button type="reset" class="cancel-btn">ยกเลิก</button>
      </div>

    </div>
  </div>
  <script src="/BudgetBuddy/javascript/nav.js"></script>
    <!-- ส่วนอื่นๆ ของ HTML -->
    <script type="module">
      // นำเข้า Firebase Modular SDK
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";
      import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";
  
      // กำหนดค่า firebaseConfig ของคุณเอง (แทนที่ YOUR_... ด้วยข้อมูลจริง)
      const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_AUTH_DOMAIN",
        projectId: "YOUR_PROJECT_ID",
        storageBucket: "YOUR_STORAGE_BUCKET",
        messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
        appId: "YOUR_APP_ID",
      };
  
      // เริ่มต้น Firebase และ Firestore
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
  
      // ฟังก์ชันสำหรับบันทึกข้อมูลและเปลี่ยนหน้า
      async function saveTransaction() {
        // ดึงค่าจากฟอร์ม
        const dateValue = document.getElementById("date").value;
        const amountValue = document.getElementById("amount").value;
        const transactionTypeValue = document.getElementById("transaction-type").value;
        const detailValue = document.getElementById("detail").value;
        const notifyValue = document.getElementById("notify").checked;
  
        // ตรวจสอบว่ากรอกข้อมูลครบถ้วนหรือไม่
        if (!dateValue || !amountValue || !transactionTypeValue) {
          alert("กรุณากรอกข้อมูลให้ครบถ้วน");
          return;
        }
  
        try {
          // บันทึกข้อมูลลงใน collection "transactions"
          await addDoc(collection(db, "transactions"), {
            date: dateValue,
            amount: parseFloat(amountValue),
            transactionType: transactionTypeValue,
            detail: detailValue,
            notify: notifyValue,
            createdAt: serverTimestamp(),
          });
  
          console.log("บันทึกข้อมูลสำเร็จ");
          // เมื่อบันทึกเสร็จ ให้เปลี่ยนหน้าไปยัง calendar.html
          window.location.href = "calendar.html";
        } catch (error) {
          console.error("เกิดข้อผิดพลาดในการบันทึกข้อมูล:", error);
          alert("ไม่สามารถบันทึกข้อมูลได้ โปรดลองอีกครั้ง");
        }
      }
  
      // ผูกฟังก์ชัน saveTransaction ให้เป็น global เพื่อให้เรียกใช้งานจาก HTML ได้
      window.saveTransaction = saveTransaction;
    </script>
  </body>
  </html>
  
</body>
</html>
